# Senior Design Lab 1 — Project Dashboard & Sensor Pipeline

A full-stack demo that streams **ESP32 DS18B20 temperature data** over **BLE** to a **Python bridge**, persists rolling readings to **JSON**, serves a **Node/Express** web app, and visualizes in the browser with **Chart.js**. Includes a simple **Settings** page with EmailJS notifications.

> Pages: Home, Graph 1, Graph 2, Settings  
> Languages: C/C++ (Arduino), Python, JavaScript (Node + Browser), HTML/CSS

---

## Repository Structure

```
.
├─ home.html
├─ server.js
├─ arduinocode.c
├─ pythoncode.py
├─ Pages/
│  ├─ graph1.html
│  ├─ graph2.html
│  └─ settings.html
└─ Scripts/
   ├─ graph1.js
   ├─ graph2.js
   ├─ settings.js
   ├─ temp1.json        # generated by python bridge at runtime
   └─ temp2.json        # generated by python bridge at runtime
```

- **Home / Shell**
  - `home.html` — Main landing page with sidebar nav and iframes for Graph pages. fileciteturn0file9
  - `server.js` — Express server, static routes, and simple in-memory `/save-user` + `/get-user` endpoints. fileciteturn0file8

- **Graphing UI**
  - `Pages/graph1.html` — Chart.js line graph; loads `../Scripts/graph1.js`. fileciteturn0file0
  - `Pages/graph2.html` — Chart.js line graph; loads `../Scripts/graph2.js`. fileciteturn0file1
  - `Scripts/graph1.js` — Fetches latest **sensor1** reading from `/Scripts/temp1.json` and live-updates the chart every 1s. fileciteturn0file3
  - `Scripts/graph2.js` — Fetches latest **sensor2** reading from `/Scripts/temp2.json` and live-updates the chart every 1s. fileciteturn0file4

- **Settings UI**
  - `Pages/settings.html` — Form (name/phone/email), EmailJS init, loads `settings.js`. fileciteturn0file2
  - `Scripts/settings.js` — Prefills existing user data, saves to `/save-user`, and sends EmailJS welcome/update messages. fileciteturn0file5

- **Sensor Pipeline**
  - `arduinocode.c` — ESP32 + DS18B20 + BLE GATT server broadcasting temperatures. LCD display helpers and on/off toggles. fileciteturn0file6
  - `pythoncode.py` — BLE **client** (Bleak) that reads two characteristics, writes rolling JSON files `temp1.json` / `temp2.json`. fileciteturn0file7

---

## End-to-End Data Flow

1) **ESP32 (BLE Peripheral)**  
   - Publishes temperature as a float over characteristic UUID(s). LCD optionally shows Sensor1/2 status. fileciteturn0file6

2) **Python Bridge (BLE Central)**  
   - Connects via **Bleak** to the ESP32 using its MAC/Address.  
   - Reads both characteristics every second, appends a reading to JSON with bounded history (≤300). fileciteturn0file7

3) **Web Server (Node/Express)**  
   - Serves static assets, exposes:
     - `POST /save-user` → stores `{name, phone, email}` in **memory** (non-persistent).  
     - `GET /get-user` → returns current user data from memory. fileciteturn0file8

4) **Browser UI (Chart.js + Fetch)**  
   - `graph1.js` polls `/Scripts/temp1.json`; `graph2.js` polls `/Scripts/temp2.json` each second; updates line chart. fileciteturn0file3 fileciteturn0file4
   - Pages include Chart.js CDN and responsive layout/styling. fileciteturn0file0 fileciteturn0file1

---

## Quickstart

### 1) Prerequisites
- Arduino IDE for ESP32 (board support installed)  
- Node.js 18+ and npm  
- Python 3.10+  
- BLE-capable host (your laptop/RPi/etc.)

### 2) Firmware (ESP32 + DS18B20)
- Open `arduinocode.c` in Arduino IDE, ensure pin assignments and DS18B20 wiring match your hardware.  
- Verify BLE **SERVICE_UUID** and **CHARACTERISTIC_UUID** (you can keep or replace).  
- Upload to ESP32. It will advertise and send temperature floats as notifications/reads. fileciteturn0file6

> **Note:** The sketch includes LCD helpers (`displayTemp1/2`) and button toggles (`checkSwitch1/2`). Ensure the button pin definitions are valid for your board. fileciteturn0file6

### 3) Python BLE Bridge
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install bleak
python pythoncode.py
```
- Set `address`, `CHAR_UUID1`, and `CHAR_UUID2` to match the ESP32 firmware.  
- The script writes rolling data to `./Scripts/temp1.json` and `./Scripts/temp2.json` (auto-creates). fileciteturn0file7

### 4) Web Server
```bash
npm install
node server.js
```
- Open `http://localhost:3000/` → Home  
- `/graph1` and `/graph2` → live charts  
- `/settings` → profile form with EmailJS integration fileciteturn0file8

### 5) Live Graphing
- `graph1.js` reads **sensor1** JSON; `graph2.js` reads **sensor2** JSON; each pushes the latest value to a Chart.js dataset every second. fileciteturn0file3 fileciteturn0file4

---

## Front-End Details

- **Pages/graph1.html** & **Pages/graph2.html**: include Chart.js 4.4 via CDN; render a responsive `<canvas id="myChart">`. fileciteturn0file0 fileciteturn0file1
- **Graph Scripts**:
  - Both scripts call `getMostRecentData()` that fetches the respective `tempX.json`, extracts the newest reading, and appends it to the dataset; chart keeps only the **last 300 points**. fileciteturn0file3 fileciteturn0file4
- **Home Page**:
  - Sidebar links and an image (TeamPic.png). Graph pages are shown inside iframes for quick preview. fileciteturn0file9
- **Settings Page**:
  - Inputs for name/phone/email; loads EmailJS; `settings.js` decides whether to send a **Welcome** or **Update** email based on `/get-user`. fileciteturn0file2 fileciteturn0file5

---

## API (Local)

### `POST /save-user`  
In-memory save of user profile. **Not persistent.**
```json
// request body
{ "name": "Alex", "phone": "555-123-4567", "email": "alex@example.com" }

// response
{ "message": "Settings saved successfully", "note": "Data is stored in server memory" }
```
fileciteturn0file8

### `GET /get-user`  
Returns current in-memory user record (or `{}` if none). fileciteturn0file8

---

## Configuration

- **EmailJS**: `settings.html` calls `emailjs.init("YOUR_PUBLIC_KEY")` and `settings.js` uses a **service** and **template** (`service_cgie0zm`, `template_6kkuq5f` in the sample). Replace with your own credentials. fileciteturn0file2 fileciteturn0file5
- **BLE IDs**: Update `address`, `CHAR_UUID1`, and `CHAR_UUID2` in `pythoncode.py` to align with the Arduino sketch’s UUIDs. fileciteturn0file7
- **Static Paths**: Express serves `/Pages`, `/Scripts`, `/Images`, and root. Routes `/graph1`, `/graph2`, `/settings` map to specific HTML files. fileciteturn0file8

---

## Troubleshooting

- **No data in charts**  
  - Ensure `pythoncode.py` is running and writing `temp1.json`/`temp2.json`.  
  - Confirm BLE address/UUIDs are correct and ESP32 is powered. fileciteturn0file7
- **Settings don’t persist after server restart**  
  - By design, storage is **in-memory** in `server.js`. Swap for a file/DB if persistence is required. fileciteturn0file8
- **Email not sending**  
  - Verify EmailJS public key, service ID, and template ID configured in HTML/JS. fileciteturn0file2 fileciteturn0file5
- **Button pins / LCD output**  
  - Double‑check pin modes/definitions; the sketch includes placeholders—adapt for your board and wiring. fileciteturn0file6

---

## Roadmap / Nice-to-Have

- Persist user settings to disk or a lightweight DB (SQLite/LowDB). fileciteturn0file8  
- Switch from polling JSON to **Server-Sent Events** or **WebSockets** for chart updates.  
- Add unit conversion (°C/°F) toggle end-to-end. fileciteturn0file6  
- Add auth and multi-user profiles.

---

## License
For a project
